<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8" />
        <title>PwnLab</title>
        <link rel="stylesheet" href="/theme/css/main.css" />

        <!--[if IE]>
            <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">InfoSec CTF </a></h1>
                <nav><ul>
                    <li class="active"><a href="/category/vulnhub-ctf.html">VulnHub CTF</a></li>
                </ul>
                </nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="/pwnlab.html" rel="bookmark"
           title="Permalink to PwnLab">PwnLab</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <span>Sun 28 August 2016</span>

</footer><!-- /.post-info -->      <p><strong>This is a PwnLab:init challenge from vulnhub.com. You can obtain the virtual
machine from: <a href="https://www.vulnhub.com/entry/pwnlab-init,158/o">here</a></strong></p>
<p>'''
The target is flag: /root/flag.txt
'''</p>
<p>Target discovery:</p>
<p><img alt="" src="images/PwnLab/1_host_discovery.png" /></p>
<p>This is what we've got when browse the web server:</p>
<p><img alt="" src="images/PwnLab/2_web.png" /></p>
<p>Nikto scan on the target web server:</p>
<p><img alt="" src="images/PwnLab/3_nikto.png" /></p>
<p>At this point i search for exploits for the target version of apache and mysql,
tried to enumerate usernames, tried to bruteforce root and admin accounts, tried
to load upload page without beeing logged in all without success. Finaly able
to move forward with LFI on page parameter in the url. This cheat sheet helped
me <a href="https://highon.coffee/blog/lfi-cheat-sheet/">link</a></p>
<p>This is what we used from the cheat sheet:</p>
<div class="highlight"><pre><span></span>http://192.168.155.131/fileincl/example1.php?page=php://filter/convert.base64-encode/resource=../../../../../etc/passwd
</pre></div>


<p>We coudn't able to read the passwd file but we know there is config.php and got
it's content with this request:</p>
<div class="highlight"><pre><span></span>http://10.0.0.141/?page=php://filter/convert.base64-encode/resource=config
</pre></div>


<p><img alt="" src="images/PwnLab/4_resp_base64.png" /></p>
<p>This is the decoded content:</p>
<p><img alt="" src="images/PwnLab/5_decode.png" /></p>
<p>So now we have the credentials for MySql database Users lets see what's there:</p>
<div class="highlight"><pre><span></span>mysql -h 10.0.0.141 -u root -p Users
</pre></div>


<p><img alt="" src="images/PwnLab/6_mysql.png" /></p>
<p>The Users database happend to be base64 encode which is great news for as. After
easily decode the hashes(using owasp zap module) we logged as mike and got us 
redirect to upload page. After we're logged in the plan is somehow to obtain
shell to the system.</p>
<p>There is some type of filter mechanism in place on uplad page allowed us to
upload only images:</p>
<p><img alt="" src="images/PwnLab/7_filter.png" /></p>
<p>I tried to bypass file type filter with various methods including change of
the extension(<em>gif, </em>png, <em>img, </em>php.img etc...) embeded php in the gif, png,
img. What did work is changing the php reverse shell extension from php to gif 
entirely(filename.gif) and add GIF89A in the beggining of the file:</p>
<p><img alt="" src="images/PwnLab/8_upload_shell.png" /></p>
<p>This is the result:</p>
<p><img alt="" src="images/PwnLab/9_pic_uploaded.png" /></p>
<p>So now we have our reverse php shell as *.gif file in 
upload/364c09c54bad2c9b2e056dcfdab5e406.gif
We have to find a way to execute it as php.</p>
    </div><!-- /.entry-content -->

  </article>
</section>
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>blogroll</h2>
                        <ul>
                            <li><a href="https://www.vulnhub.com">vulnhub</a></li>
                            <li><a href="#"></a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>

                            <li><a href=""></a></li>
                            <li><a href="https://github.com/NikolaPavlov/">github</a></li>
                            <li><a href="https://twitter.com/n_pavlov1955">twitter</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <p>Powered by <a href="http://getpelican.com/">Pelican</a>. Theme <a href="https://github.com/blueicefield/pelican-blueidea/">blueidea</a>, inspired by the default theme.</p>
        </footer><!-- /#contentinfo -->

</body>
</html>